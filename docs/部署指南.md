# 部署指南

## 环境架构

| 环境     | 平台         | 分支 |
| -------- | ------------ | ---- |
| 生产环境 | GitHub Pages | main |
| 测试环境 | Vercel       | dev  |

---

## 生产环境 (GitHub Pages)

### 自动部署

推送到 `main` 分支后，GitHub Actions 自动构建并部署到 GitHub Pages。

### 自定义域名

在 `CNAME` 文件中配置你的域名。

---

## 测试环境 (Vercel)

### 配置步骤

1. 访问 [Vercel](https://vercel.com/)
2. 点击 "Add New..." → "Project"
3. 选择 GitHub，授权并选择仓库
4. 构建设置自动从 `vercel.json` 读取
5. 点击 "Deploy"

### 功能特性

- **Preview Deployments**: 每个 PR 自动生成独立预览链接
- **Branch Deployments**: dev 分支自动部署到测试环境
- **环境标识**: 测试环境页面顶部显示"测试环境"标识
- **免费额度**: 100GB 带宽，无限构建次数

---

## 工作流程

```
开发流程:
1. 创建功能分支 → feature/xxx
2. 提交 PR → 自动生成预览链接
3. 测试通过 → 合并到 dev 分支
4. dev 分支 → 自动部署到 Vercel 测试环境
5. 测试环境验证 → 合并到 main 分支
6. main 分支 → 自动部署到 GitHub Pages 生产环境
```

---

## 环境变量

### 通用变量

| 变量                | 开发        | 测试    | 生产       |
| ------------------- | ----------- | ------- | ---------- |
| VITE_ENV            | development | staging | production |
| VITE_SHOW_ENV_BADGE | true        | true    | false      |

### 统计系统变量（可选）

如需启用统计功能，在 `.env.production` 中配置：

```env
# Supabase 配置（用于详细统计）
VITE_SUPABASE_URL=你的Supabase项目URL
VITE_SUPABASE_ANON_KEY=你的Supabase匿名密钥
```

**说明：** 建议只在生产环境配置 Supabase，测试环境不记录以节省存储空间。

### Umami Analytics（可选）

在 `index.html` 中配置：

```html
<script defer src="https://cloud.umami.is/script.js" data-website-id="你的Website ID"></script>
```

---

## 本地测试

```bash
# 开发环境
pnpm dev

# 模拟测试环境构建
pnpm build --mode staging

# 模拟生产环境构建
pnpm build --mode production

# 预览构建结果
pnpm preview
```
