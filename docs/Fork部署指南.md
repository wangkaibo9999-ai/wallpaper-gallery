# Fork éƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£ä¸º Fork æœ¬é¡¹ç›®çš„ç”¨æˆ·æä¾›å®Œæ•´çš„éƒ¨ç½²é…ç½®æŒ‡å—ã€‚

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ç¯å¢ƒå˜é‡é…ç½®](#ç¯å¢ƒå˜é‡é…ç½®)
- [Supabase æ•°æ®åº“é…ç½®](#supabase-æ•°æ®åº“é…ç½®)
- [GitHub Actions é…ç½®](#github-actions-é…ç½®)
- [ç½‘ç«™åˆ†æé…ç½®](#ç½‘ç«™åˆ†æé…ç½®)
- [Cloudflare é…ç½®](#cloudflare-é…ç½®)
- [è‡ªå®šä¹‰å›¾åºŠé…ç½®](#è‡ªå®šä¹‰å›¾åºŠé…ç½®)

---

## å¿«é€Ÿå¼€å§‹

### 1. Fork é¡¹ç›®

ç‚¹å‡» GitHub é¡µé¢å³ä¸Šè§’çš„ Fork æŒ‰é’®ï¼Œå°†é¡¹ç›® Fork åˆ°ä½ çš„è´¦æˆ·ã€‚

### 2. å…‹éš†åˆ°æœ¬åœ°

```bash
git clone https://github.com/ä½ çš„ç”¨æˆ·å/wallpaper-gallery.git
cd wallpaper-gallery
pnpm install
```

### 3. æœ¬åœ°å¼€å‘

```bash
# ç”Ÿæˆå£çº¸æ•°æ®ï¼ˆä¼šè‡ªåŠ¨ä»çº¿ä¸Šæ‹‰å–ï¼‰
pnpm generate

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
```

### 4. éƒ¨ç½²

æ¨é€åˆ° `main` åˆ†æ”¯åï¼ŒGitHub Actions ä¼šè‡ªåŠ¨æ„å»ºå¹¶éƒ¨ç½²åˆ° GitHub Pagesã€‚

---

## ç¯å¢ƒå˜é‡é…ç½®

é¡¹ç›®ä½¿ç”¨ `.env.*` æ–‡ä»¶ç®¡ç†ç¯å¢ƒå˜é‡ã€‚Fork åéœ€è¦ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ï¼š

### `.env.development` (å¼€å‘ç¯å¢ƒ)

```bash
# ç¯å¢ƒæ ‡è¯†
VITE_ENV=development
VITE_SHOW_ENV_BADGE=true

# Umami Analytics Website IDï¼ˆå¯é€‰ï¼Œç•™ç©ºåˆ™ä¸å¯ç”¨ï¼‰
VITE_UMAMI_WEBSITE_ID=ä½ çš„å¼€å‘ç¯å¢ƒWebsite_ID

# Supabase é…ç½®ï¼ˆå¯é€‰ï¼Œç•™ç©ºåˆ™ä¸å¯ç”¨ç»Ÿè®¡åŠŸèƒ½ï¼‰
VITE_SUPABASE_URL=ä½ çš„Supabaseé¡¹ç›®URL
VITE_SUPABASE_ANON_KEY=ä½ çš„SupabaseåŒ¿åKey
```

### `.env.production` (ç”Ÿäº§ç¯å¢ƒ)

```bash
# ç¯å¢ƒæ ‡è¯†
VITE_ENV=production
VITE_SHOW_ENV_BADGE=false

# Umami Analytics Website IDï¼ˆå¯é€‰ï¼‰
VITE_UMAMI_WEBSITE_ID=ä½ çš„ç”Ÿäº§ç¯å¢ƒWebsite_ID

# Supabase é…ç½®ï¼ˆå¯é€‰ï¼‰
VITE_SUPABASE_URL=ä½ çš„Supabaseé¡¹ç›®URL
VITE_SUPABASE_ANON_KEY=ä½ çš„SupabaseåŒ¿åKey
```

> **æ³¨æ„**ï¼šå¦‚æœä¸éœ€è¦ç»Ÿè®¡åŠŸèƒ½ï¼Œå¯ä»¥å°† Supabase å’Œ Umami ç›¸å…³é…ç½®ç•™ç©ºæˆ–åˆ é™¤ã€‚

---

## Supabase æ•°æ®åº“é…ç½®

Supabase ç”¨äºè®°å½•å£çº¸çš„æµè§ˆé‡å’Œä¸‹è½½é‡ç»Ÿè®¡ã€‚**æ­¤åŠŸèƒ½ä¸ºå¯é€‰**ï¼Œä¸é…ç½®ä¹Ÿä¸å½±å“ç½‘ç«™æ­£å¸¸ä½¿ç”¨ã€‚

### 1. åˆ›å»º Supabase é¡¹ç›®

1. è®¿é—® [Supabase](https://supabase.com/) å¹¶æ³¨å†Œè´¦å·
2. åˆ›å»ºæ–°é¡¹ç›®ï¼Œé€‰æ‹©ç¦»ä½ æœ€è¿‘çš„åŒºåŸŸ
3. ç­‰å¾…é¡¹ç›®åˆå§‹åŒ–å®Œæˆ

### 2. è·å–é¡¹ç›®å‡­è¯

åœ¨ Supabase æ§åˆ¶å°ä¸­ï¼š
- **Project Settings** â†’ **API**
- å¤åˆ¶ `Project URL` â†’ å¡«å…¥ `VITE_SUPABASE_URL`
- å¤åˆ¶ `anon public` Key â†’ å¡«å…¥ `VITE_SUPABASE_ANON_KEY`

### 3. åˆ›å»ºæ•°æ®åº“è¡¨

åœ¨ Supabase æ§åˆ¶å°çš„ **SQL Editor** ä¸­æ‰§è¡Œä»¥ä¸‹ SQLï¼š

```sql
-- ============================================
-- åˆ›å»ºç»Ÿè®¡è¡¨ image_stats
-- ============================================
CREATE TABLE IF NOT EXISTS public.image_stats (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  image_id TEXT NOT NULL UNIQUE,        -- å›¾ç‰‡å”¯ä¸€æ ‡è¯†ï¼ˆfilenameï¼‰
  series TEXT NOT NULL,                 -- ç³»åˆ—ï¼šdesktop, mobile, avatar, bing
  category TEXT,                        -- åˆ†ç±»
  total_views INT DEFAULT 0,            -- æ€»æµè§ˆé‡
  total_downloads INT DEFAULT 0,        -- æ€»ä¸‹è½½é‡
  last_viewed_at TIMESTAMPTZ,
  last_downloaded_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_image_stats_image_id ON image_stats(image_id);
CREATE INDEX IF NOT EXISTS idx_image_stats_series ON image_stats(series);
CREATE INDEX IF NOT EXISTS idx_image_stats_views ON image_stats(series, total_views DESC);
CREATE INDEX IF NOT EXISTS idx_image_stats_downloads ON image_stats(series, total_downloads DESC);

-- ============================================
-- åˆ›å»ºåŸå­é€’å¢å‡½æ•°
-- ============================================

-- æµè§ˆè®¡æ•°å‡½æ•°
CREATE OR REPLACE FUNCTION increment_view(
  img_id TEXT,
  series_name TEXT,
  cat TEXT DEFAULT NULL
) RETURNS VOID AS $$
BEGIN
  INSERT INTO image_stats (image_id, series, category, total_views, last_viewed_at, updated_at)
  VALUES (img_id, series_name, cat, 1, NOW(), NOW())
  ON CONFLICT (image_id) DO UPDATE SET
    total_views = image_stats.total_views + 1,
    last_viewed_at = NOW(),
    updated_at = NOW();
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- ä¸‹è½½è®¡æ•°å‡½æ•°
CREATE OR REPLACE FUNCTION increment_download(
  img_id TEXT,
  series_name TEXT,
  cat TEXT DEFAULT NULL
) RETURNS VOID AS $$
BEGIN
  INSERT INTO image_stats (image_id, series, category, total_views, total_downloads, last_downloaded_at, updated_at)
  VALUES (img_id, series_name, cat, 0, 1, NOW(), NOW())
  ON CONFLICT (image_id) DO UPDATE SET
    total_downloads = image_stats.total_downloads + 1,
    last_downloaded_at = NOW(),
    updated_at = NOW();
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- ============================================
-- é…ç½® RLS æƒé™
-- ============================================

-- å¯ç”¨ RLS
ALTER TABLE image_stats ENABLE ROW LEVEL SECURITY;

-- å…è®¸åŒ¿åç”¨æˆ·è¯»å–
CREATE POLICY "Allow anonymous read" ON image_stats
  FOR SELECT
  USING (true);

-- ============================================
-- åˆ›å»ºå¯¼å‡ºçƒ­é—¨æ•°æ®çš„å‡½æ•°ï¼ˆä¾› GitHub Actions ä½¿ç”¨ï¼‰
-- ============================================
CREATE OR REPLACE FUNCTION get_hot_stats(
  series_filter TEXT,
  limit_count INT DEFAULT 500
) RETURNS TABLE (
  image_id TEXT,
  total_views INT,
  total_downloads INT
) AS $$
BEGIN
  RETURN QUERY
  SELECT
    i.image_id,
    i.total_views,
    i.total_downloads
  FROM image_stats i
  WHERE i.series = series_filter
  ORDER BY i.total_views DESC
  LIMIT limit_count;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

### 4. éªŒè¯é…ç½®

æ‰§è¡Œä»¥ä¸‹ SQL éªŒè¯è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸï¼š

```sql
SELECT * FROM image_stats LIMIT 10;
```

---

## GitHub Actions é…ç½®

### å¿…éœ€çš„ Secrets

åœ¨ GitHub ä»“åº“çš„ **Settings** â†’ **Secrets and variables** â†’ **Actions** ä¸­æ·»åŠ ï¼š

| Secret åç§° | è¯´æ˜ | æ˜¯å¦å¿…éœ€ |
|------------|------|---------|
| `CLOUDFLARE_ZONE_ID` | Cloudflare åŒºåŸŸ ID | å¯é€‰ï¼ˆç”¨äºç¼“å­˜æ¸…é™¤ï¼‰ |
| `CLOUDFLARE_API_TOKEN` | Cloudflare API Token | å¯é€‰ï¼ˆç”¨äºç¼“å­˜æ¸…é™¤ï¼‰ |
| `VITE_SUPABASE_URL` | Supabase é¡¹ç›® URL | å¯é€‰ï¼ˆç”¨äºç»Ÿè®¡å¯¼å‡ºï¼‰ |
| `VITE_SUPABASE_ANON_KEY` | Supabase åŒ¿å Key | å¯é€‰ï¼ˆç”¨äºç»Ÿè®¡å¯¼å‡ºï¼‰ |

### å·¥ä½œæµè¯´æ˜

| å·¥ä½œæµ | æ–‡ä»¶ | è§¦å‘æ¡ä»¶ | åŠŸèƒ½ |
|-------|------|---------|------|
| Deploy | `deploy.yml` | æ¨é€åˆ° main / æ¯æ—¥å®šæ—¶ / æ‰‹åŠ¨ | æ„å»ºå¹¶éƒ¨ç½²åˆ° GitHub Pages |
| Export Stats | `export-stats.yml` | æ¯æ—¥å®šæ—¶ / æ‰‹åŠ¨ | å¯¼å‡ºçƒ­é—¨ç»Ÿè®¡æ•°æ® |

### å¯ç”¨ GitHub Pages

1. è¿›å…¥ä»“åº“ **Settings** â†’ **Pages**
2. Source é€‰æ‹© **GitHub Actions**
3. é¦–æ¬¡éƒ¨ç½²åä¼šè‡ªåŠ¨ç”Ÿæˆè®¿é—®åœ°å€

---

## ç½‘ç«™åˆ†æé…ç½®

### Umami Analyticsï¼ˆæ¨èï¼‰

[Umami](https://umami.is/) æ˜¯ä¸€ä¸ªå¼€æºçš„ç½‘ç«™åˆ†æå·¥å…·ï¼Œæ³¨é‡éšç§ä¿æŠ¤ã€‚

#### é…ç½®æ­¥éª¤

1. æ³¨å†Œ [Umami Cloud](https://cloud.umami.is/) æˆ–è‡ªå»º Umami
2. æ·»åŠ ç½‘ç«™ï¼Œè·å– Website ID
3. å°† Website ID å¡«å…¥ `.env.production` çš„ `VITE_UMAMI_WEBSITE_ID`

#### è‡ªå»º Umami

å¦‚æœä½ æƒ³è‡ªå»º Umamiï¼Œå¯ä»¥å‚è€ƒ [Umami å®˜æ–¹æ–‡æ¡£](https://umami.is/docs/getting-started)ã€‚

### Cloudflare Web Analyticsï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ çš„ç½‘ç«™ä½¿ç”¨ Cloudflareï¼Œå¯ä»¥å¯ç”¨å…è´¹çš„ Web Analyticsï¼š

1. ç™»å½• Cloudflare Dashboard
2. è¿›å…¥ **Analytics & Logs** â†’ **Web Analytics**
3. æ·»åŠ ç«™ç‚¹å¹¶è·å– JS ä»£ç 
4. å°†ä»£ç æ·»åŠ åˆ° `index.html`

---

## Cloudflare é…ç½®

å¦‚æœä½ ä½¿ç”¨ Cloudflare ä½œä¸º CDNï¼Œå¯ä»¥é…ç½®è‡ªåŠ¨ç¼“å­˜æ¸…é™¤ã€‚

### è·å– Zone ID

1. ç™»å½• Cloudflare Dashboard
2. é€‰æ‹©ä½ çš„åŸŸå
3. åœ¨ **Overview** é¡µé¢å³ä¾§æ‰¾åˆ° **Zone ID**

### åˆ›å»º API Token

1. è¿›å…¥ **My Profile** â†’ **API Tokens**
2. ç‚¹å‡» **Create Token**
3. ä½¿ç”¨ **Edit zone DNS** æ¨¡æ¿æˆ–è‡ªå®šä¹‰æƒé™
4. ç¡®ä¿åŒ…å« **Zone** â†’ **Cache Purge** â†’ **Purge** æƒé™
5. é™åˆ¶ Zone ä¸ºä½ çš„åŸŸå

### æ·»åŠ åˆ° GitHub Secrets

- `CLOUDFLARE_ZONE_ID`: Zone ID
- `CLOUDFLARE_API_TOKEN`: API Token

---

## è‡ªå®šä¹‰å›¾åºŠé…ç½®

é»˜è®¤æƒ…å†µä¸‹ï¼Œé¡¹ç›®ä½¿ç”¨ä½œè€…çš„å›¾åºŠæ•°æ®ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨è‡ªå·±çš„å›¾åºŠï¼š

### 1. å‡†å¤‡å›¾åºŠä»“åº“

åˆ›å»ºä¸€ä¸ª GitHub ä»“åº“å­˜æ”¾å£çº¸å›¾ç‰‡ï¼Œç›®å½•ç»“æ„ï¼š

```
your-wallpaper-repo/
â”œâ”€â”€ wallpaper/
â”‚   â”œâ”€â”€ desktop/          # ç”µè„‘å£çº¸
â”‚   â”‚   â”œâ”€â”€ åˆ†ç±»1/
â”‚   â”‚   â””â”€â”€ åˆ†ç±»2/
â”‚   â”œâ”€â”€ mobile/           # æ‰‹æœºå£çº¸
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ avatar/           # å¤´åƒ
â”‚       â””â”€â”€ ...
â””â”€â”€ thumbnail/            # ç¼©ç•¥å›¾ï¼ˆå¯é€‰ï¼‰
    â”œâ”€â”€ desktop/
    â”œâ”€â”€ mobile/
    â””â”€â”€ avatar/
```

### 2. ä¿®æ”¹ CDN é…ç½®

ç¼–è¾‘ `src/utils/constants.js`ï¼š

```javascript
// æ›¿æ¢ä¸ºä½ çš„å›¾åºŠåœ°å€
export const CDN_BASE_URL = 'https://cdn.jsdelivr.net/gh/ä½ çš„ç”¨æˆ·å/ä½ çš„å›¾åºŠä»“åº“@main'
export const CDN_VERSION = 'main'  // æˆ–ä½¿ç”¨ tag ç‰ˆæœ¬
```

### 3. ä¿®æ”¹æ•°æ®ç”Ÿæˆè„šæœ¬

ç¼–è¾‘ `scripts/generate-data.js`ï¼š

```javascript
// æ›¿æ¢ä¸ºä½ çš„çº¿ä¸Šæ•°æ®æºï¼ˆå¦‚æœæœ‰ï¼‰
const ONLINE_DATA_BASE_URL = 'https://ä½ çš„åŸŸå/data'
```

### 4. ä¿®æ”¹ GitHub Actions

ç¼–è¾‘ `.github/workflows/deploy.yml`ï¼Œå°†å›¾åºŠä»“åº“æ”¹ä¸ºä½ çš„ï¼š

```yaml
- name: Checkout wallpaper source
  uses: actions/checkout@v4
  with:
    repository: ä½ çš„ç”¨æˆ·å/ä½ çš„å›¾åºŠä»“åº“
    path: nuanXinProPic
```

---

## å¸¸è§é—®é¢˜

### Q: ä¸é…ç½® Supabase ä¼šæ€æ ·ï¼Ÿ

A: ç½‘ç«™å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œåªæ˜¯æ²¡æœ‰æµè§ˆé‡/ä¸‹è½½é‡ç»Ÿè®¡åŠŸèƒ½ï¼Œçƒ­é—¨æ’åºä¹Ÿä¸ä¼šç”Ÿæ•ˆã€‚

### Q: ä¸é…ç½® Umami ä¼šæ€æ ·ï¼Ÿ

A: ç½‘ç«™å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œåªæ˜¯æ²¡æœ‰è®¿é—®ç»Ÿè®¡åˆ†æåŠŸèƒ½ã€‚

### Q: ä¸é…ç½® Cloudflare ä¼šæ€æ ·ï¼Ÿ

A: ç½‘ç«™å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œåªæ˜¯éƒ¨ç½²åä¸ä¼šè‡ªåŠ¨æ¸…é™¤ CDN ç¼“å­˜ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…ç¼“å­˜è¿‡æœŸã€‚

### Q: å¦‚ä½•ä½¿ç”¨è‡ªå·±çš„åŸŸåï¼Ÿ

A: 
1. åœ¨ä»“åº“æ ¹ç›®å½•åˆ›å»º `CNAME` æ–‡ä»¶ï¼Œå†…å®¹ä¸ºä½ çš„åŸŸå
2. åœ¨åŸŸå DNS ä¸­æ·»åŠ  CNAME è®°å½•æŒ‡å‘ `ä½ çš„ç”¨æˆ·å.github.io`
3. åœ¨ GitHub Pages è®¾ç½®ä¸­é…ç½®è‡ªå®šä¹‰åŸŸå

### Q: æ„å»ºå¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. ç¡®ä¿ `pnpm-lock.yaml` å·²æäº¤
2. æ£€æŸ¥ GitHub Actions æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
3. ç¡®ä¿ Secrets é…ç½®æ­£ç¡®ï¼ˆå¦‚æœä½¿ç”¨äº†ç›¸å…³åŠŸèƒ½ï¼‰

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿æäº¤ [Issue](https://github.com/IT-NuanxinPro/wallpaper-gallery/issues)ã€‚
