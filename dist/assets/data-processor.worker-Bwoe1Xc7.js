(function(){"use strict";const f={Q:"A",W:"B",E:"C",R:"D",T:"E",Y:"F",U:"G",I:"H",O:"I",P:"J",A:"K",S:"L",D:"M",F:"N",G:"O",H:"P",J:"Q",K:"R",L:"S",Z:"T",X:"U",C:"V",V:"W",B:"X",N:"Y",M:"Z",q:"a",w:"b",e:"c",r:"d",t:"e",y:"f",u:"g",i:"h",o:"i",p:"j",a:"k",s:"l",d:"m",f:"n",g:"o",h:"p",j:"q",k:"r",l:"s",z:"t",x:"u",c:"v",v:"w",b:"x",n:"y",m:"z",5:"0",6:"1",7:"2",8:"3",9:"4",0:"5",1:"6",2:"7",3:"8",4:"9","-":"+",_:"/",".":"="},d="v1.";function u(o){if(!o.startsWith(d))throw new Error("Invalid data format");const t=o.slice(d.length).split("").reverse().join("").split("").map(r=>f[r]||r).join("");return decodeURIComponent(escape(atob(t)))}const c={sortByDate:(o,n="desc")=>[...o].sort((t,r)=>{const s=new Date(t.createdAt),e=new Date(r.createdAt);return n==="desc"?e-s:s-e}),sortByPopularity:(o,n)=>{const t=new Map(n);return[...o].sort((r,s)=>{const e=t.get(r.filename)?.score||0,a=t.get(s.filename)?.score||0;return a===e?new Date(s.createdAt)-new Date(r.createdAt):a-e})},sortByDownloads:(o,n)=>{const t=new Map(n);return[...o].sort((r,s)=>{const e=t.get(r.filename)?.downloads||0,a=t.get(s.filename)?.downloads||0;return a===e?new Date(s.createdAt)-new Date(r.createdAt):a-e})},sortByViews:(o,n)=>{const t=new Map(n);return[...o].sort((r,s)=>{const e=t.get(r.filename)?.views||0,a=t.get(s.filename)?.views||0;return a===e?new Date(s.createdAt)-new Date(r.createdAt):a-e})},sortBySize:(o,n="desc")=>[...o].sort((t,r)=>n==="desc"?r.size-t.size:t.size-r.size),sortByName:(o,n="asc")=>[...o].sort((t,r)=>n==="asc"?t.filename.localeCompare(r.filename):r.filename.localeCompare(t.filename))};function w(o){const{wallpapers:n,filters:t,sortMethod:r,popularityMap:s}=o;let e=[...n];if(t.searchQuery){const a=t.searchQuery.toLowerCase();e=e.filter(l=>l.filename.toLowerCase().includes(a)||l.category?.toLowerCase().includes(a)||l.subcategory?.toLowerCase().includes(a)||l.tags&&l.tags.some(i=>i.toLowerCase().includes(a)))}switch(t.formatFilter&&t.formatFilter!=="all"&&(e=e.filter(a=>a.format.toLowerCase()===t.formatFilter.toLowerCase())),t.categoryFilter&&t.categoryFilter!=="all"&&(e=e.filter(a=>a.category===t.categoryFilter)),t.subcategoryFilter&&t.subcategoryFilter!=="all"&&(e=e.filter(a=>a.subcategory===t.subcategoryFilter)),r){case"newest":e=c.sortByDate(e,"desc");break;case"oldest":e=c.sortByDate(e,"asc");break;case"popular":case"weekly-hot":case"monthly-hot":e=c.sortByPopularity(e,s);break;case"downloads":e=c.sortByDownloads(e,s);break;case"views":e=c.sortByViews(e,s);break;case"largest":e=c.sortBySize(e,"desc");break;case"smallest":e=c.sortBySize(e,"asc");break;case"name-asc":e=c.sortByName(e,"asc");break;case"name-desc":e=c.sortByName(e,"desc");break}return e}self.onmessage=function(o){const{type:n,id:t,data:r}=o.data;try{let s;switch(n){case"decode":{s=u(r.encoded);break}case"decodeAndParse":{const e=u(r.encoded);s=JSON.parse(e);break}case"sort":{const{method:e,wallpapers:a,options:l}=r,i=c[e];if(!i)throw new Error(`Unknown sort method: ${e}`);s=i(a,l);break}case"filterAndSort":{s=w(r);break}default:throw new Error(`Unknown message type: ${n}`)}self.postMessage({id:t,success:!0,result:s})}catch(s){self.postMessage({id:t,success:!1,error:s.message})}}})();
